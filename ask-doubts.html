<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Ask Doubts – AI Learner</title>

  <style>
    :root{
      --bg1:#160630;
      --bg2:#6c1d6c;
      --panel:#d6c4cf;
      --primary:#5c277d;
      --bubble-user:#cba9ff;
      --bubble-ai:#ffffff;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      height:100vh;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      font-family:Segoe UI,Arial;color:#fff;
      overflow:hidden;
    }

    /* Sidebar */
    .sidebar{
      position:fixed;left:0;top:0;
      width:240px;height:100vh;
      background:var(--panel);
      padding:30px 20px;
    }
    .nav a{
      display:block;
      padding:12px 10px;
      color:#222;text-decoration:none;
      border-radius:8px;
      margin-bottom:6px;
      font-weight:500;
    }
    .nav a.active, .nav a:hover{
      background:#fff;
    }

    /* Chat container */
    .chat-area{
      position:absolute;
      left:260px;
      top:0;
      width:calc(100% - 260px);
      height:100vh;
      padding:20px;
      display:flex;
      flex-direction:column;
    }

    .chat-box{
      flex:1;
      overflow-y:auto;
      padding-right:20px;
      scroll-behavior:smooth;
    }

    /* Chat bubbles */
    .bubble{
      max-width:70%;
      padding:12px 16px;
      border-radius:14px;
      margin:8px 0;
      font-size:15px;
      line-height:1.4;
      white-space:pre-wrap;
    }
    .user{
      background:var(--bubble-user);
      color:#000;
      margin-left:auto;
      border-bottom-right-radius:4px;
    }
    .ai{
      background:var(--bubble-ai);
      color:#000;
      margin-right:auto;
      border-bottom-left-radius:4px;
    }

    /* Input bar */
    .input-row{
      display:flex;
      gap:10px;
      padding:10px 0;
    }
    .input-row input{
      flex:1;
      padding:14px;
      border-radius:10px;
      border:none;
    }
    .send-btn{
      background:var(--primary);
      color:#fff;
      border:none;
      padding:0 18px;
      border-radius:10px;
      cursor:pointer;
      font-size:18px;
    }
  </style>
</head>

<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand" style="font-size:22px;font-weight:bold;margin-bottom:20px;">AI Learner</div>
    <nav class="nav">
      <a href="dashboard.html">Dashboard</a>
      <a href="ask-doubts.html" style="background:#fff;">Ask Doubts</a>
      <a href="generate-quiz.html">Generate Quiz</a>
      <a href="rewards.html">Rewards</a>
      <a href="history.html">History</a>
      <a href="profile.html">Profile</a>
    </nav>
  </aside>

  <!-- Chat Interface -->
  <section class="chat-area">
    
    <!-- Chat messages -->
    <div class="chat-box" id="chatBox"></div>

    <!-- Input -->
    <div class="input-row">
      <input id="question" type="text" placeholder="Type your doubt...">
      <button class="send-btn" id="sendBtn">➤</button>
    </div>
  </section>


<script>
const chatBox = document.getElementById("chatBox");
const qInput = document.getElementById("question");
const sendBtn = document.getElementById("sendBtn");

function addMessage(text, type){
  const div = document.createElement("div");
  div.className = `bubble ${type}`;
  div.textContent = text;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

async function ask(){
  const q = qInput.value.trim();
  if(!q) return;

  // User bubble
  addMessage(q, "user");

  qInput.value = "";

  // AI thinking bubble
  const loadingBubble = document.createElement("div");
  loadingBubble.className = "bubble ai";
  loadingBubble.textContent = "Thinking...";
  chatBox.appendChild(loadingBubble);
  chatBox.scrollTop = chatBox.scrollHeight;

  try{
    const r = await fetch("http://127.0.0.1:8000/ask", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({ question: q })
    });

    const data = await r.json();
    
    // remove thinking
    chatBox.removeChild(loadingBubble);

    // add AI reply
    addMessage(data.answer || "No response", "ai");

  }catch(err){
    loadingBubble.textContent = "Error: Could not reach server.";
  }
}

sendBtn.addEventListener("click", ask);
qInput.addEventListener("keydown", e => {
  if(e.key === "Enter") ask();
});
</script>

</body>
</html>
